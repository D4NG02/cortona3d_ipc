/*! Cortona3D Solo Tag 2.0.0, Copyright (c) 2015-2022 Paragraphics, Ltd. (http://www.cortona3d.com/) */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Cortona3DSoloTag=t():e.Cortona3DSoloTag=t()}(window,(function(){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){var o=n(1);"undefined"!=typeof Cortona3DSolo&&(Cortona3DSolo.tag=o,Cortona3DSolo.use("tag").then((function(e){var t,n;if(e.config.useBackwardCompatibilityMode)for(t in o)window[t]=o[t];else for(t in n={on_model_reset:"tag.onModelReset",on_initialize:"tag.onInitialize",on_section_loaded:"tag.onSectionLoaded",on_section_unloaded:"tag.onSectionUnloaded",on_click_object:"tag.onClickObject",on_over_object:"tag.onOverObject",on_over:"tag.onOver"})Object.defineProperty(o.Model3D.instance,t,{value:Cortona3DSolo.dispatch.bind(Cortona3DSolo,n[t]),enumerable:!0})}))),e.exports=o},function(e,t){var n={};void 0===n&&(n={}),function(e){var t,n,o=new P,i={areaData:"",color:[1,0,0],location:new d(0,0,0),normal:[0,1,0],sectionID:"",shapeType:0,structureClass:"",texture:0,type:"dot",vp_orientation:[0,0,1,0],vp_position:[0,0,0]},r=["dot","line","area"],l=["LS","RS","LTF","RTF","LTA","RTA","LBF","RBF","LBA","RBA","TOP","BTM"],s=void 0===window.ActiveXObject&&!("ActiveXObject"in window),a=null,u=Object.create(null),c=!1;function d(e,t,n){this.x=e,this.y=t,this.z=n}function _(){this.position=[0,0,0],this.orientation=[0,0,1,0],this.centerpoint=[0,0,0]}function h(e){return[getValue(e,"float"),getValue(e+4,"float"),getValue(e+8,"float")]}function f(e){return[getValue(e,"float"),getValue(e+4,"float"),getValue(e+8,"float"),getValue(e+12,"float")]}function p(e){return new d(getValue(e,"float"),getValue(e+4,"float"),getValue(e+8,"float"))}function g(e,t){setValue(e,t[0],"float"),setValue(e+4,t[1],"float"),setValue(e+8,t[2],"float")}function m(e,t){setValue(e,t[0],"float"),setValue(e+4,t[1],"float"),setValue(e+8,t[2],"float"),setValue(e+12,t[3],"float")}function v(e,t){setValue(e,t.x,"float"),setValue(e+4,t.y,"float"),setValue(e+8,t.z,"float")}function b(){var e,t,n,o=this.constructor.name+" {",i=!1;for(e in this)"function"!==(n=typeof(t=this[e]))&&(o+=(i?", ":" ")+e+"=","string"===n?o+='"'+t+'"':"object"!==n||t.constructor!==Array&&t.constructor!==d&&t.constructor!==_?o+=t:o+="["+t+"]",i=!0);return o+=" }"}function S(){var e="";Object.defineProperties(this,{_peer:{value:0,writable:!0},_state:{value:Object.create(i),writable:!0,configurable:!0},id:{get:function(){return e},set:function(t){this._peer&&!o._dotWillChangeID(this,t)||(e=t)}}})}function M(e,t){var n,o;if(Module._stella_item_release(e._peer),e._peer=Module._stella_dot_create(),Module.ccall("stella_item_setID","null",["number","string"],[e._peer,e.id]),Module._stella_model_addRepairDot(e._peer),e._state){for(o in n=e._state)e[o]=n[o];delete e._state}}function A(e){return{type:e.type,color:e.color,location:e.location,normal:e.normal,vp_position:e.vp_position,vp_orientation:e.vp_orientation,shapeType:e.shapeType,texture:e.texture,sectionID:e.sectionID,structureClass:e.structureClass,areaData:e.areaData}}function y(e){e._peer&&(e._state=A(e),Module._stella_model_removeRepairDot(e._peer),Module._stella_item_release(e._peer),e._peer=0)}function T(e,t,n){var o=e;this.name=t,this.url=n,this.isLoaded=!1,Object.defineProperties(this,{_peer:{value:0,writable:!0},id:{enumerable:!0,get:function(){return o},set:function(e){this._peer||(o=e)}}})}function D(e,t,n,o,i){if(e){var r,l,s,a,u=stackSave(),c=i?i.length:0,d=c?stackAlloc(4*(c+1)):0;for(r=0;r<c;++r)setValue(d+4*r,stackAlloc(intArrayFromString(i[r])),"i32");if(setValue(d+4*c,0,"i32"),l=Module[o](e,t.x,t.y,t.z,n,d),stackRestore(u),l){for(a=[],c=getValue(l,"i32"),s=l+4,r=0;r<c;++r,s+=20)a.push({name:UTF8ToString(getValue(s,"*")),distance:getValue(s+4,"float"),translation:new X(getValue(s+8,"float"),getValue(s+12,"float"),getValue(s+16,"float"))});return Module._free(l),a}}}function L(e,t){Module._stella_section_release(e._peer),e._peer=Module.ccall("stella_section_create","number",["string","string"],[e.id,e.url]),Module._stella_model_addSection(e._peer);var n=P.instance.metadata,o=e.id.split(":"),i=n.sectionIdToCode(o.length>1?o[1]:e.id);e.translation=n.coordAirplaneFuselageToVRML(n.getOffsetForSection(i))}function O(e,t){Module._stella_model_removeSection(e._peer),Module._stella_section_release(e._peer),e._peer=0,o._rebuildStructures(e)}function x(e){var t=e.indexOf("_");return t<0?e:e.substr(0,t)}function C(e,t,n){Object.defineProperties(this,{id:{value:e,enumerable:!0},name:{value:e,enumerable:!0},structureClass:{value:x(e),enumerable:!0},sectionID:{value:t,enumerable:!0},_peer:{value:n||0,writable:!0}}),n&&Module._stella_item_retain(n)}function E(e){Object.defineProperty(this,"name",{value:e,enumerable:!0})}function R(e){var t,n,o=e(),i=Object.create(null);if(o){for(n=0;t=UTF8ToString(getValue(o+n,"*"));n+=4)i[t]=t;Module._free(o)}return i}function w(e,t){Object.defineProperties(e,{get:{value:function(e){return t[e]?t[e]:null}},exists:{value:function(e){return!!t[e]}},contains:{value:function(e){return!!t[e]}},toArray:{value:function(){var e,n=[];for(e in t)n.push(t[e]);return n}}})}function N(e,t,n,o,i,r){Object.defineProperties(e,{add:{value:function(e){e instanceof o&&!t[e.id]&&(t[e.id]=e,n&&i(e,n))}},remove:{value:function(e){var o=t[e];o&&(n&&r(o,n),delete t[e])}},clear:{value:function(){var e;for(e in t)n&&r(t[e]),delete t[e]}},get:{value:function(e){return t[e]?t[e]:null}},exists:{value:function(e){return!!t[e]}},contains:{value:function(e){return!!t[e]}},toArray:{value:function(){var e,n=[];for(e in t)n.push(t[e]);return n}}})}function P(){if(o)return o;var e=Object.create(null),i=Object.create(null),s=Object.create(null),u=Object.create(null),h=new function(e,t){N(this,e,t,S,M,y),Object.defineProperty(this,"removeForSection",{value:function(n){var o;for(o in e)e[o].sectionID==n&&(t&&y(e[o]),delete e[o])}})}(e,this),f=new function(e,t){N(this,e,t,T,L,O)}(i,this),v=new function(e){w(this,e)}(s,this),b=new function(e){w(this,e)}(u,this),A={};this.DEFAULT_TRANSPARENCY_LEVEL=.6,this.MOUSE_MOVE_SENSITIVITY=3,this.SKIP_TRANSPARENT_OBJECT=!0,this.SKIP_TRANSPARENT_OBJECT_ON_CLICK=!1,this.TOOLTIP_DELAY=500,this.ENABLE_TOOLTIPS=!0,this.DOT_FLASH_INTERVAL=3,this.DOT_FLASH_FREQUENCY=2,this.ALL_CLASS_VISIBLE_ON_LOAD=!1,this.SKIN_STRUCTURE_LIST=["RDM","WIN","DR","SKN","FC","FRG"],this.DOT_TO_STRUCTURE_DISTANCE=2,this.AC_SCALE_POWER=1/.0254,this.areaContourOffset=1.5,this.areaSurfaceOffset=3,this.maxAreaEdgeLength=20,Object.defineProperties(this,{metadata:{enumerable:!0,value:new z},dotScalePower:{enumerable:!0,get:function(){return Module._stella_model_getDotAppearance(0)},set:function(e){return Module._stella_model_setDotAppearance(0,e)}},dotScaleMult:{enumerable:!0,get:function(){return Module._stella_model_getDotAppearance(1)},set:function(e){return Module._stella_model_setDotAppearance(1,e)}},lineScalePower:{enumerable:!0,get:function(){return Module._stella_model_getDotAppearance(2)},set:function(e){return Module._stella_model_setDotAppearance(2,e)}},lineScaleMult:{enumerable:!0,get:function(){return Module._stella_model_getDotAppearance(3)},set:function(e){return Module._stella_model_setDotAppearance(3,e)}},textureScalePower:{enumerable:!0,get:function(){return Module._stella_model_getDotAppearance(4)},set:function(e){return Module._stella_model_setDotAppearance(4,e)}},textureScaleMult:{enumerable:!0,get:function(){return Module._stella_model_getDotAppearance(5)},set:function(e){return Module._stella_model_setDotAppearance(5,e)}},areaSurfaceTransparency:{enumerable:!0,get:function(){return Module._stella_model_getDotAppearance(6)},set:function(e){return Module._stella_model_setDotAppearance(6,e)}},Dots:{value:h,enumerable:!0},Sections:{value:f,enumerable:!0},StructureClasses:{value:b,enumerable:!0},isDotsShown:{get:function(){return!Module._stella_model_areRepairDotsHidden()},enumerable:!0},dotsSwitch:{value:function(e){return Module._stella_model_setRepairDotsHidden(!e)}},dots:{value:h,enumerable:!0},sections:{value:f,enumerable:!0},structures:{value:v,enumerable:!0},structureClasses:{value:b,enumerable:!0},dotsHidden:{get:function(){return!!Module._stella_model_areRepairDotsHidden()},set:function(e){return Module._stella_model_setRepairDotsHidden(e)},enumerable:!0},addSection:{value:function(e){f.add(e)}},removeSection:{value:function(e){f.remove(e)}},removeAllSections:{value:function(){f.clear()}},getSectionsArray:{value:function(){return f.toArray()}},getSection:{value:function(e){return i[e]}},addRepairDot:{value:function(e){h.add(e)}},removeRepairDot:{value:function(e){h.remove(e.id)}},getRepairDotsArray:{value:function(){return h.toArray()}},getRepairDot:{value:function(t){return e[t]}},getStructureClassesArray:{value:function(){return b.toArray()}},getCursorDot:{value:function(){var e=Module._stella_model_getNewbornDot();if(a){if(a._peer==e)return a;y(a)}return(a=new S).id=UTF8ToString(Module._stella_item_getID(e)),a._peer=e,Module._stella_item_retain(e),a}},startPlotMode:{value:function(e,t){c=!0,Module.ccall("stella_model_beginPlotMode","null",["string","number"],[""+e,t?r.indexOf(t):0])}},endPlotMode:{value:function(){c=!1,Module._stella_model_endPlotMode(),a&&y(a)}},isPlotMode:{get:function(){return c},enumerable:!0},completeAreaDot:{value:function(){Module._stella_model_buildAreaDot()}},undoAreaVertex:{value:function(){Module._stella_model_removeLastAreaPoint()}},checkPlot:{value:function(e){var t=e.location,n=Module._stella_model_copyNearestElementList(t.x,t.y,t.z,!1),o=!1;return n&&(o=0!=getValue(n,"*"),Module._free(n)),o}},getNearestStructuresForDot:{value:function(e,t){var n=e.location;return function(e,t,n,o){var i,r,l=Module._stella_model_copyNearestElementList(e,t,n,o),s=[];if(l){for(r=0;i=UTF8ToString(getValue(l+r,"*"));r+=4)s.push(i);Module._free(l)}return s}(n.x,n.y,n.z,t)}},getPredefinedViewArray:{value:function(){return l.slice()}},setView:{value:function(e){var n,o,i,r;e.constructor===String?(n=l.indexOf(e))>=0&&Module._stella_model_fitSceneWithPredefinedView(n,!0):e.constructor===S?e._peer&&(o=stackSave(),i=stackAlloc(40),r=Module._stella_dot_getViewpoint(e._peer),Module.HEAPU8.set(Module.HEAPU8.subarray(r,r+28),i),Module._stella_item_getCenter(e._peer,i+28),Module._stella_model_setCameraPosition(i,40,!0),stackRestore(o),t&&t.stopFlash(),e.flash(),t=e):e.constructor===C?Module._stella_model_fitItem(e._peer,"undefined"==typeof animated||animated):e.constructor===_&&(o=stackSave(),g(i=stackAlloc(40),e.position),m(i+12,e.orientation),g(i+28,e.centerpoint),Module._stella_model_setCameraPosition(i,40,!0),stackRestore(o))}},setCenterpoint:{value:function(e){var t=stackSave(),n=stackAlloc(12),o=!1,i=!1;e.constructor===d?(g(n,e.toArray()),o=!0):e.constructor===S||e.constructor===C?e._peer&&(Module._stella_item_getCenter(e._peer,n),o=!0,i=!0):e.constructor===_?(g(n,e.centerpoint),o=!0):e.constructor===Array&&(g(n,e),o=!0),Module._stella_model_setRotationCenter(o?n:0,i),stackRestore(t)}},resetCenterpoint:{value:function(e){Module._stella_model_setRotationCenter(0,!1)}},alignModel:{value:function(e){Module._stella_model_alignCamera(void 0===e||e)}},fitToModel:{value:function(e){Module._stella_model_fitScene(void 0===e||e)}},fitToStructure:{value:function(e,t){Module._stella_model_fitItem(e._peer,void 0===t||t)}},switchOSDAxis:{value:function(e){Module._stella_model_setOSAxisHidden(!e)}},switchOSDCenterpoint:{value:function(e){Module._tiramisu_setRotationCenterVisibility(e)}},reset:{value:function(){this.tooltipOver3D&&this.tooltipOver3D.hide(),n=null,this.on_model_reset&&this.on_model_reset()}},initialize:{value:function(e){var t=new k(e);t.delay=this.TOOLTIP_DELAY,Object.defineProperty(this,"tooltipOver3D",{value:t,enumerable:!0}),this.on_initialize&&this.on_initialize()}},_sectionDidFinishLoad:{value:function(e,t){var n,r,l,a,c,d=null;for(n in i)if((d=i[n])._peer===e)break;if(d){for(n=0;r=UTF8ToString(getValue(t+n,"*"));n+=8)s[r]||(l=new C(r,d.id,getValue(t+n+4,"*")),s[r]=l,r=l.structureClass,u[r]||(a=new E(r),u[r]=a,c=o.SKIN_STRUCTURE_LIST.indexOf(r)>=0&&!o.ALL_CLASS_VISIBLE_ON_LOAD,a.hidden=c,a.dotsHidden=c));d.isLoaded=!0,this.on_section_loaded&&this.on_section_loaded(d)}}},_rebuildStructures:{value:function(e){var t,n,o=R(Module._stella_model_copyStructureList);for(t in s)o[t]||(n=s[t],Module._stella_item_release(n._peer),n._peer=0,delete s[t]);for(t in o=R(Module._stella_model_copyStructureClassList),u)o[t]||delete u[t];e&&this.on_section_unloaded&&this.on_section_unloaded(e)}},_dotWillChangeID:{value:function(t,n){var o=e[n];return(!o||o===t)&&(e[t.id]&&delete e[t.id],e[n]=t,!0)}},_didClick:{value:function(t,n,o,i,r,l){var a;i=p(i),r=UTF8ToString(r),0===l?a=s[r]:1===l&&(a=e[r]),a&&this.on_click_object&&this.on_click_object(i,a,1,o)}},_didHover:{value:function(t,o,i,r,l){var a;i=p(i),r=UTF8ToString(r),0===l?a=s[r]:1===l&&(a=e[r]),n!=a&&(this.tooltipOver3D.hide(),n=a,"function"==typeof this.on_over_object&&this.on_over_object(i,a||A)),a&&this.ENABLE_TOOLTIPS&&this.tooltipOver3D.show(t,o),this.on_over&&this.on_over(i,a||A)}},structureClassSwitch:{value:function(e,t){var n=u[e];n&&(n.hidden=!t)}},structureClassTransparent:{value:function(e,t){var n=u[e];n&&(n.transparency=t?o.DEFAULT_TRANSPARENCY_LEVEL:0)}},structureClassDotsSwitch:{value:function(e,t){var n=u[e];n&&(n.dotsHidden=!t)}},structureClassGetModel:{value:function(e){var t=u[e];return t&&!t.hidden}},structureClassGetTransparency:{value:function(e){var t=u[e];return t?t.transparency:0}},modelTransparent:{value:function(e){var t,n=e?o.DEFAULT_TRANSPARENCY_LEVEL:0;for(t in u)u[t].transparency=n}},getStructuresInSphere:{value:function(e,t,n,o){if(i[e])return i[e].getStructuresInSphere(t,n,o)}},getStructuresAcrossFuselage:{value:function(e,t,n,o){if(i[e])return i[e].getStructuresAcrossFuselage(t,maxDistance,o)}},getDistanceToStructure:{value:function(e,t,n,o){var i,r=s[t];return r&&r.sectionID==e?(i=r.getDistanceToPoint(n),void 0===o?i:Math.min(i,o)):-1}},MODEL_ROTATION:{get:function(){var e,t=stackSave(),n=stackAlloc(16);return Module._stella_model_getModelRotation(n),e=new U(getValue(n,"float"),getValue(n+4,"float"),getValue(n+8,"float"),getValue(n+12,"float")),stackRestore(t),e},set:function(e){var t=stackSave(),n=stackAlloc(16);m(n,e?e.toArray():[0,0,1,0]),Module._stella_model_setModelRotation(n),stackRestore(t)},enumerable:!0}})}function F(){this.center=new V(0,0,0),this.size=new V(0,0,0)}function V(e,t,n){this.BSTA=e,this.BWL=t,this.BBL=n}function I(e,t,n){var o=0,i=[],r=null;function l(e,t,n){var i,r,l=e?e.selectSingleNode("//zone[@id='"+t+"']"):null,s=[];if(l&&(i=l.selectNodes("shape/text()")).length){for(r=0;r<i.length;++r)s.push(i[r].nodeValue);Module.ccall("stella_model_setZoneVisible","null",["number","string","number"],[o,s.join(" "),n])}}Object.defineProperty(this,"_document",{value:null,writable:!0}),n&&B(this,"_document",e),Object.defineProperties(this,{loadXmlZones:{value:function(e){var t=!1;return s?(this._document=(new DOMParser).parseFromString(e,"text/xml"),t="object"==typeof this.dom):this._document&&(this._document=new ActiveXObject("Microsoft.XMLDOM"),this._document.async=!1,t=this._document.loadXML(e)),t||console.log("An error occurred while loading zones metadata XML"),this}},load:{value:function(n,i){var l="function"==typeof n;r=l?{didFinishLoadSection:n,didFailLoadSection:"function"==typeof i?i:null,documentStatus:0,sceneStatus:0,errorText:null}:null,this._document||B(this,"_document",e,l?function(){r.sceneStatus?(r.sceneStatus>0?r.didFinishLoadSection():r.didFailLoadSection&&r.didFailLoadSection(r.errorText),r=null):r.documentStatus=1}:null,l?function(e){if(!r.sceneStatus)return r.documentStatus=-1,void(r.errorText=e);r.didFailLoadSection&&r.didFailLoadSection(e),r=null}:null),o||(o=Module.ccall("stella_model_loadZones","number",["string"],[t]),u[o]=this)}},unload:{value:function(){o&&(Module._stella_model_unloadZones(o),delete u[o],o=0,i=[])}},showZone:{value:function(e){i?i.push(e):l(this._document,e,!0)}},hideZone:{value:function(e){var t;i?(t=i.indexOf(e))>=0&&i.splice(t,1):l(this._document,e,!1)}},_didFinishLoad:{value:function(){var e;if(i)for(e=0;e<i.length;++e)l(this._document,i[e],!0);if(i=null,r){if(!r.documentStatus)return void(r.sceneStatus=1);r.documentStatus>0?r.didFinishLoadSection():r.didFailLoadSection&&r.didFailLoadSection(r.errorText),r=null}}}})}function z(){this.dom=null}function B(e,t,n,o,i){var r,l="function"==typeof o;return s?((r=new XMLHttpRequest).open("GET",n,l),r.responseType="document",r.overrideMimeType("text/xml"),l&&(r.onload=function(){200==r.status&&r.responseXML?(e[t]=r.responseXML,o()):"function"==typeof i&&i(200!=r.status?r.statusText+" (status code: "+r.status+")":"Malformed XML")},r.onerror=function(){"function"==typeof i&&i(r.statusText+" (status code: "+r.status+")")}),r.send(),l||(e[t]=r.responseXML),l||"object"==typeof r.responseXML):((r=new ActiveXObject("Microsoft.XMLDOM")).async=l,l?r.onreadystatechange=function(){4==r.readyState&&(0==r.parseError.errorCode?(e[t]=r,o()):"function"==typeof i&&i(r.parseError.reason))}:e[t]=r,r.load(n))}function j(e,t){var n=Math.round(Math.pow(10,Math.max(t,0)));return String(Math.round(e*n)/n)}function H(e,t){this.ata=e,this.description=t}function k(e){var t="",n=e,o=0,i=!1,r=0,l=0;this.delay=500,this.TOOLTIP_DX=12,this.TOOLTIP_DY=12,Object.defineProperties(this,{setTooltipHTML:{value:function(e){t=e}},show:{value:function(e,s){var a=this.TOOLTIP_DX,u=this.TOOLTIP_DY;n.innerHTML=t,i||(arguments.length>=2&&(r=e,l=s),clearTimeout(o),o=setTimeout((function(){var e=n.parentNode.getBoundingClientRect(),t=Math.min(r+a,e.right-e.left-n.offsetWidth),o=Math.min(l+u,e.bottom-e.top-n.offsetHeight),s=n.style;s.left=t+"px",s.top=o+"px",n.classList.add("is-visible"),i=!0}),this.delay))}},hide:{value:function(){clearTimeout(o),o=0,i&&(n.classList.remove("is-visible"),i=!1)}},_moveTo:{value:function(e,t){r=e,l=t}}})}function U(){if(4==arguments.length)this.x=arguments[0],this.y=arguments[1],this.z=arguments[2],this.angle=arguments[3];else if(2==arguments.length)if("number"==typeof arguments[1])this.setAxis(arguments[0]),this.angle=arguments[1];else{var e=1.192092896e-7,t=arguments[0].normalize(),n=arguments[1].normalize(),o=t.cross(n),i=o.length();i<=e?t.dot(n)<0?(o=t.cross(new X(1,0,0)),this.angle=Math.PI,(i=o.length())<=e&&(o=t.cross(new X(0,1,0))),o=o.normalize()):(o=new X(0,1,0),this.angle=0):(this.angle=Math.atan2(i,t.dot(n)),o=o.normalize()),this.setAxis(o)}else this.x=0,this.y=1,this.z=0,this.angle=0}function X(e,t,n){this.x=e,this.y=t,this.z=n}d.prototype.toArray=function(){return[this.x,this.y,this.z]},d.prototype.toString=function(){return this.x+" "+this.y+" "+this.z},Object.defineProperties(_.prototype,{fromString:{value:function(e){var t=e.split(" ");return this.position=t.slice(0,3),this.orientation=t.slice(3,7),this.centerpoint=t.slice(7),this}},fromCurrentViewpoint:{value:function(e){var t=stackSave(),n=stackAlloc(40);return Module._stella_model_getCameraPosition(n,40),this.position=h(n),this.orientation=f(n+12),this.centerpoint=h(n+28),stackRestore(t),this}},toString:{value:function(){return this.position.join(" ")+" "+this.orientation.join(" ")+" "+this.centerpoint.join(" ")}}}),Object.defineProperties(S,{SHAPE_NONE:{value:0},SHAPE_BOX:{value:1},SHAPE_SPHERE:{value:2},SHAPE_PRISM:{value:3},SHAPE_CROSS:{value:4},TEXTURE_NONE:{value:0},TEXTURE_HATCH:{value:1},TEXTURE_CROSSHATCH:{value:2},TEXTURE_DOTS:{value:3},TEXTURE_CIRCLES:{value:4}}),Object.defineProperties(S.prototype,{areaData:{enumerable:!0,get:function(){var e,t;return this._peer?(e=Module._stella_dot_copyAreaData(this._peer),t=UTF8ToString(e),Module._free(e),t):this._state.areaData},set:function(e){this._peer?Module.ccall("stella_dot_setAreaData","null",["number","string"],[this._peer,e]):this._state.areaData=e}},color:{enumerable:!0,get:function(){return this._peer?h(Module._stella_dot_getColor(this._peer)):this._state.color},set:function(e){this._peer?Module._stella_dot_setColor(this._peer,e[0],e[1],e[2]):this._state.color=e}},location:{enumerable:!0,get:function(){return this._peer?p(Module._stella_dot_getLocation(this._peer)):this._state.location},set:function(e){this._peer?e.constructor===Array?Module._stella_dot_setLocation(this._peer,e[0],e[1],e[2]):Module._stella_dot_setLocation(this._peer,e.x,e.y,e.z):this._state.location=e}},normal:{enumerable:!0,get:function(){return this._peer?h(Module._stella_dot_getNormal(this._peer)):this._state.normal},set:function(e){this._peer?Module._stella_dot_setNormal(this._peer,e[0],e[1],e[2]):this._state.normal=e}},shapeType:{enumerable:!0,get:function(){return this._peer?Module._stella_dot_getShapeType(this._peer):this._state.shapeType},set:function(e){this._peer?Module._stella_dot_setShapeType(this._peer,0|e):this._state.shapeType=e}},texture:{enumerable:!0,get:function(){return this._peer?Module._stella_dot_getTextureType(this._peer):this._state.texture},set:function(e){this._peer?Module._stella_dot_setTextureType(this._peer,0|e):this._state.texture=e}},type:{enumerable:!0,get:function(){return this._peer?r[Module._stella_dot_getType(this._peer)]:this._state.type},set:function(e){this._peer?Module._stella_dot_setType(this._peer,r.indexOf(e)):this._state.type=e}},sectionID:{enumerable:!0,get:function(){return this._peer?UTF8ToString(Module._stella_dot_getSectionID(this._peer)):this._state.sectionID},set:function(e){this._peer?Module.ccall("stella_dot_setSectionID","null",["number","string"],[this._peer,e]):this._state.sectionID=e}},structureClass:{enumerable:!0,get:function(){return this._peer?UTF8ToString(Module._stella_dot_getStructureClass(this._peer)):this._state.structureClass},set:function(e){this._peer?Module.ccall("stella_dot_setStructureClass","null",["number","string"],[this._peer,e]):this._state.structureClass=e}},vp_position:{enumerable:!0,get:function(){return this._peer?h(Module._stella_dot_getViewpoint(this._peer)):this._state.vp_position},set:function(e){var t,n;this._peer?(t=stackSave(),g(n=stackAlloc(12),e),Module._stella_dot_setViewpoint(this._peer,n,0),stackRestore(t)):this._state.vp_position=e}},vp_orientation:{enumerable:!0,get:function(){return this._peer?f(12+Module._stella_dot_getViewpoint(this._peer)):this._state.vp_orientation},set:function(e){var t,n;this._peer?(t=stackSave(),m(n=stackAlloc(16),e),Module._stella_dot_setViewpoint(this._peer,0,n),stackRestore(t)):this._state.vp_orientation=e}},hidden:{enumerable:!0,get:function(){return!(!this._peer||!Module._stella_item_isHidden(this._peer))},set:function(e){this._peer&&Module._stella_item_setHidden(this._peer,e)}},isShown:{value:function(){return!(!this._peer||Module._stella_item_isHidden(this._peer))}},show:{value:function(e){this._peer&&Module._stella_item_setHidden(this._peer,!e)}},highlight:{value:function(e){this._peer&&Module._stella_item_setHighlighted(this._peer,e)}},flash:{value:function(e,t){this._peer&&Module._stella_dot_flash(this._peer,e?0|e:o.DOT_FLASH_INTERVAL,t?0|t:o.DOT_FLASH_FREQUENCY)}},stopFlash:{value:function(){this._peer&&Module._stella_dot_cancelFlash(this._peer)}},cloneDot:{value:function(){var e=new S;return e.id=this.id,e._state=A(this),e}},assignCurrentView:{value:function(){var e=stackSave(),t=stackAlloc(28);Module._stella_model_getCameraPosition(t,28),this._peer?Module._stella_dot_setViewpoint(this._peer,t,t+12):(this._state.vp_position=h(t),this._state.vp_orientation=f(t+12)),stackRestore(e)}},toString:{value:b},refresh:{value:function(){}}}),Object.defineProperties(T.prototype,{hidden:{enumerable:!0,get:function(){return this._peer&&!!Module._stella_section_isHidden(this._peer)},set:function(e){this._peer&&Module._stella_section_setHidden(this._peer,e)}},translation:{enumerable:!0,get:function(){if(this._peer)return p(Module._stella_section_getTranslation(this._peer))},set:function(e){this._peer&&Module._stella_section_setTranslation(this._peer,e.x,e.y,e.z)}},repairDotsHidden:{enumerable:!0,get:function(){return this._peer&&!!Module._stella_section_areRepairDotsHidden(this._peer)},set:function(e){this._peer&&Module._stella_section_setRepairDotsHidden(this._peer,e)}},loadFromUrl:{value:function(e){this.url=e,this._peer&&Module.ccall("stella_section_load","null",["number","string"],[this._peer,this.url])}},load:{value:function(){this._peer&&Module.ccall("stella_section_load","null",["number","string"],[this._peer,null])}},unload:{value:function(){var e=this.isLoaded;this._peer&&Module._stella_section_unload(this._peer),this.isLoaded=!1,e&&o._rebuildStructures(this)}},switchModel:{value:function(e){this._peer&&Module._stella_section_setHidden(this._peer,!e)}},switchDots:{value:function(e){this._peer&&Module._stella_section_setRepairDotsHidden(this._peer,!e)}},getStructuresInSphere:{value:function(e,t,n){return D(this._peer,e,t,"_stella_section_getStructuresInSphere",n||null)}},getStructuresAcrossFuselage:{value:function(e,t,n){return D(this._peer,e,t,"_stella_section_getStructuresAcrossFuselage",n||null)}},toString:{value:b}}),Object.defineProperties(C.prototype,{hidden:{enumerable:!0,get:function(){return!(!this._peer||!Module._stella_item_isHidden(this._peer))},set:function(e){this._peer&&Module._stella_item_setHidden(this._peer,e)}},transparency:{enumerable:!0,get:function(){return this._peer?Module._stella_element_getTransparency(this._peer):0},set:function(e){this._peer&&Module._stella_element_setTransparency(this._peer,e)}},highlight:{value:function(e){this._peer&&Module._stella_item_setHighlighted(this._peer,e,!0)}},changeColor:{value:function(e){this._peer&&Module._stella_element_setColor(this._peer,e[0],e[1],e[2],!0)}},restoreColor:{value:function(){this._peer&&Module._stella_element_restoreColor(this._peer,!0)}},getDistanceToPoint:{value:function(e){return this._peer?Module._stella_element_getDistanceToPoint(this._peer,e.x,e.y,e.z):-1}},toString:{value:b}}),Object.defineProperties(E.prototype,{transparency:{enumerable:!0,get:function(){return Module.ccall("stella_model_getStructureClassTransparency","number",["string"],[this.name])},set:function(e){Module.ccall("stella_model_setStructureClassTransparency","null",["string","number"],[this.name,e,!0])}},hidden:{enumerable:!0,get:function(){return!!Module.ccall("stella_model_isStructureClassHidden","number",["string"],[this.name])},set:function(e){Module.ccall("stella_model_setStructureClassHidden","null",["string","number","number"],[this.name,e,!0])}},dotsHidden:{enumerable:!0,get:function(){return!!Module.ccall("stella_model_areDotsWithStructureClassHidden","number",["string"],[this.name])},set:function(e){Module.ccall("stella_model_setDotsWithStructureClassHidden","null",["string","number","number"],[this.name,e,!0])}},isDotsShown:{enumerable:!0,get:function(){return!Module.ccall("stella_model_areDotsWithStructureClassHidden","number",["string"],[this.name])}},switchDots:{value:function(e){Module.ccall("stella_model_setDotsWithStructureClassHidden","null",["string","number","number"],[this.name,!e,!0])}},isShown:{enumerable:!0,get:function(){return!Module.ccall("stella_model_isStructureClassHidden","number",["string"],[this.name])}},switchModel:{value:function(e){Module.ccall("stella_model_setStructureClassHidden","null",["string","number"],[this.name,!e])}},isTransparent:{enumerable:!0,get:function(){return Module.ccall("stella_model_getStructureClassTransparency","number",["string"],[this.name])>0}},switchTransparent:{value:function(e){Module.ccall("stella_model_setStructureClassTransparency","null",["string","number","number"],[this.name,e?o.DEFAULT_TRANSPARENCY_LEVEL:0,!0])}},getTransparencyLevel:{value:function(){return Module.ccall("stella_model_getStructureClassTransparency","number",["string"],[this.name])}},toString:{value:b}}),Object.defineProperty(P,"instance",{value:o}),s&&(Object.defineProperties(Element.prototype,{selectSingleNode:{value:function(e){return this.ownerDocument.evaluate(e,this,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}},selectNodes:{value:function(e){for(var t,n=this.ownerDocument.evaluate(e,this,null,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null),o=[];t=n.iterateNext();)o.push(t);return o}}}),Object.defineProperties(XMLDocument.prototype,{selectSingleNode:{value:function(e){return this.evaluate(e,this,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}},selectNodes:{value:function(e){for(var t,n=this.evaluate(e,this,null,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null),o=[];t=n.iterateNext();)o.push(t);return o}}})),F.prototype.fromXMLNode=function(e){return this.center.fromXMLNode(e.selectSingleNode("center")),this.center.BBL=-this.center.BBL,this.size.fromXMLNode(e.selectSingleNode("size")),this},F.prototype.isInside=function(e){return Math.abs(e.BSTA-this.center.BSTA)<=this.size.BSTA/2&&Math.abs(e.BBL-this.center.BBL)<=this.size.BBL/2&&Math.abs(e.BWL-this.center.BWL)<=this.size.BWL/2},F.prototype.isEmpty=function(){return 0==this.size.BSTA&&0==this.size.BBL&&0==this.size.BWL},F.prototype.toString=function(){return"CENTER("+this.center+") SIZE("+this.size+")"},V.prototype.fromXMLNode=function(e,t){var n,o=void 0===t?{BSTA:"bsta",BWL:"bwl",BBL:"bbl"}:t;try{for(n in o)this[n]=parseFloat(e.getAttribute(o[n]))}catch(e){}return this},V.prototype.getBLSideString=function(){return this.BBL<0?"LS":this.BBL>0?"RS":""},V.prototype.toString=b,Object.defineProperty(I,"_didFinishLoad",{value:function(e){u[e]&&u[e]._didFinishLoad()}}),Object.defineProperties(I.prototype,{getAllZones:{value:function(){var e,t,n=[];if(this._document)for(e=this._document.selectNodes("//zone"),t=0;t<e.length;++t)n.push(e[t].getAttribute("id"));return n}},getSectionId:{value:function(){var e,t="";return this._document&&(e=this._document.selectSingleNode("//zones"))&&(t=e.getAttribute("section_id")),t}},getZone:{value:function(e,t){if(this._document){var n,o,i,r,l,s,a,u,c,_,h,f,p,g,m,v=void 0!==t&&""!=t,b=this._document.selectNodes(v?"//zone[zoneitems/item/text()='"+t+"']":"//zone");if(b.length>0){if(e.constructor===d)n=e;else{if(e.constructor!==S)return;n=e.location}for(o=n.x,i=n.y,r=n.z,s=0;s<b.length;++s)for(m=b[s].selectNodes("boxes/box"),a=0;a<m.length;++a){for(u=m[a].selectNodes("plane"),_=0,l=0;l<u.length&&(c=u[l]).getAttribute("a")*o+c.getAttribute("b")*i+c.getAttribute("c")*r<=c.getAttribute("d");++l)_++;if(_==u.length)return b[s].getAttribute("id")}if(v){for(h=null,p=100,s=0;s<b.length;++s)for(g=101,m=b[s].selectNodes("boxes/box"),a=0;a<m.length;++a){for(u=m[a].selectNodes("plane"),_=0,l=0;l<u.length;++l)(f=(c=u[l]).getAttribute("a")*o+c.getAttribute("b")*i+c.getAttribute("c")*r-c.getAttribute("d"))<=0?_++:g>f&&(g=f);_==u.length-1&&p>g&&(p=g,h=b[s])}if(h)return h.getAttribute("id")}}}return null}},getAllElementsInZone:{value:function(e){var t,n,o=[];if(this._document)for(t=this._document.selectNodes("//zone[@id='"+e+"']/zoneitems/item/text()"),n=0;n<t.length;++n)o.push(t[n].nodeValue);return o}}}),z.prototype.sectionCodeToId=function(e){if(this.isAvailable()){var t=null;try{t=this.dom.selectSingleNode('(//section | //fullbird)[@code="'+e+'"]').getAttribute("id")}catch(e){}if(!t)try{t=this.dom.selectSingleNode('/airplane/fullbird//item[.="'+e+'"]').getAttribute("ref")}catch(e){}return t||(t=this.dom.selectSingleNode("/airplane/fullbird").getAttribute("id")),t}},z.prototype.sectionIdToCode=function(e){if(this.isAvailable()){var t=null;try{t=this.dom.selectSingleNode('(//fullbird | //section)[@id="'+e+'"]').getAttribute("code")}catch(e){}if(!t)try{t=this.dom.selectSingleNode('/airplane/fullbird//item[@ref="'+e+'"]/text()').nodeValue}catch(e){}return t||(t="FULLBIRD_SECTION_MAP"),t}},z.prototype.isAvailable=function(){return this.dom&&this.dom.documentElement},z.prototype.load=function(e,t,n){return B(this,"dom",e,t||null,n||null)},z.prototype.getOffsetForSection=function(e){var t,n,o,i=0,r=0,l=0;return this.isAvailable()&&(t=this.sectionCodeToId(e),(n=this.dom.selectSingleNode('//section[@id="'+t+'"]'))&&((o=n.getAttribute("offset-bsta"))&&(i=parseFloat(o)),(o=n.getAttribute("offset-bwl"))&&(r=parseFloat(o)),(o=n.getAttribute("offset-bbl"))&&(l=parseFloat(o)))),new V(i,r,l)},z.prototype.coordAirplaneFuselageToVRML=function(e){var t=o.AC_SCALE_POWER;return new d(-e.BBL/t,e.BWL/t,-e.BSTA/t)},z.prototype.coordVRMLToAirplaneFuselage=function(e){var t=o.AC_SCALE_POWER;return new V(-e.z*t,e.y*t,-e.x*t)},z.prototype.coordBSTAToExtendedBSTA=function(e,t){try{var n,o,i,r,l,s,a,u,c,d,_,h=this.dom.selectNodes("airplane/fuselage-coordinates/*");for(n=0;n<h.length;++n){if(r=h[n],l=parseFloat(r.getAttribute("last-before")),s=parseFloat(r.getAttribute("first-after")),a=parseFloat(r.getAttribute("first-inserted-distance")),e<l)return j(e,t);if("insertion-plus"==r.tagName){if(e<s+(u=parseFloat(r.getAttribute("size"))))return"+0"==(i="+"+j(c=e-l,t))&&(i=""),j(l,t)+i;e-=u}else if("insertion-letter"==r.tagName){if((d=e-l)<a)return"+0"==(i="+"+j(d,t))&&(i=""),j(l,t)+i;for(d-=a,_=r.selectNodes("inserted-frame"),o=0;o<_.length;++o){if(d<(c=parseFloat(_[o].getAttribute("distance-to-next"))))return"+0"==(i="+"+j(d,t))&&(i=""),j(l,t)+_[o].getAttribute("letter")+i;d-=c}e=s+d}}}catch(e){}return j(e,t)},z.prototype.coordExtendedBSTAToBSTA=function(e){var t,n,o,i,r,l,s,a,u,c,d,_,h,f,p,g;try{if(1!=(t=String(e).toUpperCase().replace(",",".").replace(/ /g,"").split("+")).length&&2!=t.length)return-1;if(n=parseFloat(t[0]),isNaN(n))return-1;if(o=0,2==t.length&&(o=parseFloat(t[1]),isNaN(o)))return-1;for(((i=t[0].substring(t[0].length-1))<"A"||i>"Z")&&(i=""),r=!1,l=!1,a=(s=this.dom.selectNodes("airplane/fuselage-coordinates/*")).length-1;a>=0;--a)if(c=s[a],d=parseFloat(c.getAttribute("last-before")),_=parseFloat(c.getAttribute("first-after")),h=parseFloat(c.getAttribute("first-inserted-distance")),"insertion-plus"==c.tagName)n>=_?n+=parseFloat(c.getAttribute("size")):n>=d&&(r=!0);else if("insertion-letter"==c.tagName)if(f=c.selectNodes("inserted-frame"),n>=_)for(n-=_-d,n+=h,u=f.length-1;u>=0;--u)n+=parseFloat(f[u].getAttribute("distance-to-next"));else if(n>=d)for(""==i?r=!0:n+=h,u=f.length-1;u>=0;--u)p=parseFloat(f[u].getAttribute("distance-to-next")),i==(g=f[u].getAttribute("letter"))?(r=!0,l=!0):i>g&&(n+=p);return 0!=o&&!r||""!=i&&!l?-1:n+o}catch(e){return-1}},z.prototype.getSectionBB=function(e){var t,n,o=new F;if(this.isAvailable()){t=this.sectionCodeToId(e),n=this.dom.selectSingleNode('//section[@id="'+t+'"]');try{o.fromXMLNode(n.selectSingleNode("boundbox"))}catch(e){}}return o},z.prototype.getAirplaneSectionsForLocation=function(e){var t,n,o,i,r=[];if(this.isAvailable())for(t=this.dom.selectNodes("//section"),n=0;n<t.length;++n)o=t[n].getAttribute("id"),i=this.sectionIdToCode(o),this.getSectionBB(i).isInside(e)&&r.push(i);return r},z.prototype.getFuselageSectionsForLocation=function(e){var t,n,o,i,r=[];if(this.isAvailable())for(t=this.dom.selectNodes("//section"),n=0;n<t.length;++n)((o=t[n].getAttribute("id")).indexOf("_FUS_")>=0||o.indexOf("_C")>=0)&&(i=this.sectionIdToCode(o),this.getSectionBB(i).isInside(e)&&r.push(sectioncode));return r},z.prototype.chooseViewpoint=function(e,t){var n=this.coordAirplaneFuselageToVRML(this.getSectionBB(t).center,t),o=stackSave(),i=stackAlloc(28),r=new _;return v(i,e),v(i+12,n),setValue(i+24,3,"float"),Module._stella_utility_getBestViewpoint(i),r.position=h(i),r.orientation=f(i+12),r.centerpoint=e.toArray(),stackRestore(o),r},z.prototype.getATAForZone=function(e,t){var n,o,i,r,l,s,a,u,c=[];if(this.dom){for(n=Object.create(null),o=e.getSectionId(),elements=e.getAllElementsInZone(t),i=this.dom.selectSingleNode("//section[@id='"+o+"']"),r=0;r<elements.length;++r)for(s=i.selectNodes(".//item[.='"+elements[r]+"']"),l=0;l<s.length;++l)null!=(u=s[l].getAttribute("ATA"))&&(n[u]=!0);for(a in n)c.push(a);for(c.sort(),r=0;r<c.length;++r)u=(u=this.dom.selectSingleNode("//atadescription[@ATA='"+c[r]+"']/text()"))?u.nodeValue:"",c[r]=new H(c[r],description)}return c},H.prototype.toString=function(){return this.ata+(this.description?" - "+this.description:"")},Object.defineProperties(U.prototype,{toArray:{value:function(){return[this.x,this.y,this.z,this.angle]}},multVec:{value:function(e){var t=-this.angle,n=Math.sin(t),o=Math.cos(t),i=this.x,r=this.y,l=this.z,s=e.x,a=e.y,u=e.z,c=(i*s+r*a+l*u)*(1-o);return new X(i*c+o*s+n*(l*a-r*u),r*c+o*a+n*(i*u-l*s),l*c+o*u+n*(r*s-i*a))}},inverse:{value:function(){return new U(this.x,this.y,this.z,-this.angle)}},multiply:{value:function(e){var t,n=e.angle,o=Math.sin(n/2),i=Math.cos(n/2),r=e.getAxis().multiply(o),l=Math.sin(this.angle/2),s=Math.cos(this.angle/2),a=this.getAxis().multiply(l),u=i*s-r.dot(a),c=r.multiply(s).add(a.multiply(i)).add(a.cross(r)),d=c.x*c.x+c.y*c.y+c.z*c.z,_=new U(0,0,1,0);return 0!=d&&(t=Math.sqrt(d),_.setAxis(c.divide(t)),_.angle=2*Math.atan2(t,u)),_}},setAxis:{value:function(e){this.x=e.x,this.y=e.y,this.z=e.z}},getAxis:{value:function(){return new X(this.x,this.y,this.z)}},toString:{value:function(){return this.toArray().join(" ")}}}),Object.defineProperties(X.prototype,{toArray:{value:function(){return[this.x,this.y,this.z]}},add:{value:function(e){return new X(e.x+this.x,e.y+this.y,e.z+this.z)}},subtract:{value:function(e){return new X(this.x-e.x,this.y-e.y,this.z-e.z)}},dot:{value:function(e){return e.x*this.x+e.y*this.y+e.z*this.z}},cross:{value:function(e){return new X(this.y*e.z-e.y*this.z,this.z*e.x-e.z*this.x,this.x*e.y-e.x*this.y)}},divide:{value:function(e){return new X(this.x/e,this.y/e,this.z/e)}},multiply:{value:function(e){return new X(this.x*e,this.y*e,this.z*e)}},length:{value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},normalize:{value:function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return 0==e?this:this.divide(e)}},negate:{value:function(){return new X(-this.x,-this.y,-this.z)}}}),Object.defineProperties(e,{Location:{value:d,enumerable:!0},Dot:{value:S,enumerable:!0},Section:{value:T,enumerable:!0},Structure:{value:C,enumerable:!0},Viewpoint:{value:_,enumerable:!0},Model3D:{value:P,enumerable:!0},ATA:{value:H,enumerable:!0},AirplaneFuselageLocation:{value:V,enumerable:!0},AirplaneBoundBox:{value:F,enumerable:!0},Metadata:{value:z,enumerable:!0},ZSection:{value:I,enumerable:!0},Vec3f:{value:X,enumerable:!0},Rotation:{value:U,enumerable:!0},didInitializeRuntime:{value:function(){Tiramisu.willStartNavigateInScene=function(){o.tooltipOver3D&&o.tooltipOver3D.hide()}}}})}(n),e.exports=n}])}));
//# sourceMappingURL=Cortona3DSoloTag.js.map